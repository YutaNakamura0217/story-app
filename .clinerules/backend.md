# 一般的なテスト作成時の注意点

-   **インポートパスの解決**:
    -   `pytest` を特定のディレクトリ (例: `backend/`) から実行する場合、テストファイル内での他モジュールからのインポートは、その実行ディレクトリをルートとした相対パスで記述する (例: `from tests.crud.module import helper` や `from app.crud.module import function`)。
    -   `PYTHONPATH` の設定や `sys.path` への追加も検討できるが、一貫したインポート戦略をプロジェクトで持つことが望ましい。

-   **Enumメンバーの参照**:
    -   Pythonの `enum.Enum` を使用する場合、メンバーへのアクセスは定義された通りの大文字・小文字で行う (例: `MyEnum.MEMBER_NAME` であり、`MyEnum.member_name` ではない)。

-   **CRUD関数のシグネチャ確認**:
    -   テスト対象のCRUD関数を呼び出す際は、必ずその関数の最新のシグネチャ（引数名、型、順序）を確認し、テストコード側の呼び出しを一致させる。特にキーワード引数の名前に注意する。

-   **Pydanticスキーマとテストデータ**:
    -   Pydanticモデルをテストデータとして使用する場合、スキーマ定義で必須とされているフィールドがすべて提供されていることを確認する。Optionalでないフィールドは必ず値を渡す。
    -   Create系スキーマとUpdate系スキーマで必須フィールドが異なる場合があるので注意する。

-   **日時の扱いとタイムゾーン**:
    -   `datetime` オブジェクトを扱う際、特に生成時や比較時にはタイムゾーン情報を意識する。
    -   `datetime.utcnow()` (naive datetimeを返す、非推奨) の代わりに、タイムゾーン対応の `datetime.now(timezone.utc)` (aware datetimeを返す) を使用することを推奨する (`from datetime import timezone` が必要)。
    -   テストでの時刻比較時、実行速度によるマイクロ秒単位の差異で失敗する可能性があるため、`>=` や `!=` を使うか、微小な許容範囲を設けるなどの工夫を検討する。

-   **テストの前提条件とCRUD関数の実際の動作**:
    -   テストケースが依存するCRUD関数の動作 (例: 特定の条件下でのフィルタリング、関連オブジェクトの自動作成など) を正確に理解し、アサーションが実際の動作と一致するようにする。不一致がある場合は、テストを修正するか、CRUD関数を修正するかを明確にする。

-   **データベースの順序保証**:
    -   データベースから複数のレコードを取得する際、特定の順序を期待する場合は、テスト対象のCRUD関数が `ORDER BY` を指定しているか確認し、テストのアサーションもその順序を考慮するか、順序に依存しない方法 (IDのセット比較など) で行う。
